        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');

        /* --- GOALS PANEL --- */
        #goals-panel {
            width: 420px;
            background: #112019;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 55;
            position: absolute;
            right: 0;
            top: var(--right-rail-reserved-top);
            bottom: 0;
            transition: transform 0.3s ease, visibility 0s linear 0s;
            box-shadow: -8px 0 24px rgba(0, 0, 0, 0.4);
        }

        #goals-panel.hidden {
            transform: translateX(100%);
            visibility: hidden;
            pointer-events: none;
            transition: transform 0.3s ease, visibility 0s linear 0.3s;
        }

        .goals-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.3);
        }

        .year-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 6px;
        }

        .goal-filter-controls {
            margin-bottom: 10px;
        }

        .year-title {
            font-size: 18px;
            font-weight: 800;
            color: #fff;
            letter-spacing: 1px;
        }

        .goal-tree {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .goal-node {
            --goal-rgb: 255, 255, 255;
            margin-bottom: 7px;
            position: relative;
        }

        .goal-content {
            display: flex;
            align-items: flex-start;
            padding: 8px 10px;
            border-radius: 8px;
            background-color: #161716;
            background-image: linear-gradient(90deg, rgba(var(--goal-rgb), 0.12) 0%, rgba(var(--goal-rgb), 0.03) 38%, transparent 72%);
            border: 1px solid rgba(255, 255, 255, 0.04);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.14);
            transition: border-color 0.2s ease, background-image 0.2s ease, background-color 0.2s ease;
        }

        .goal-content::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: rgb(var(--goal-rgb));
            box-shadow: 2px 0 10px rgba(var(--goal-rgb), 0.42);
        }

        .goal-content:hover {
            border-color: rgba(var(--goal-rgb), 0.28);
            background-image: linear-gradient(90deg, rgba(var(--goal-rgb), 0.18) 0%, rgba(var(--goal-rgb), 0.05) 52%, transparent 80%);
        }

        .goal-node:not(.goal-level-1) > .goal-content {
            background-color: #1a1b1a;
            background-image: none;
            border-color: rgba(255, 255, 255, 0.03);
            box-shadow: none;
        }

        .goal-node:not(.goal-level-1) > .goal-content::before {
            width: 2px;
            opacity: 0.18;
            box-shadow: none;
            transition: opacity 0.2s ease, box-shadow 0.2s ease;
        }

        .goal-node:not(.goal-level-1) > .goal-content:hover {
            background-color: #202220;
            border-color: rgba(255, 255, 255, 0.07);
            background-image: none;
        }

        .goal-node:not(.goal-level-1) > .goal-content:hover::before {
            opacity: 1;
            box-shadow: 1px 0 8px rgba(var(--goal-rgb), 0.5);
        }

        .goal-caret {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.46);
            font-size: 10px;
            margin-right: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .goal-caret:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .goal-caret.collapsed {
            transform: rotate(-90deg);
        }

        .goal-caret.invisible {
            opacity: 0;
            pointer-events: none;
        }

        .goal-text {
            flex-grow: 1;
            font-size: 13px;
            background: transparent;
            border: none;
            color: #e5e7eb;
            padding: 4px;
            border-bottom: 1px solid transparent;
            transition: border 0.2s;
            width: 100%;
            min-height: 22px;
            line-height: 1.35;
            resize: none;
            overflow: hidden;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .goal-text:focus {
            outline: none;
            border-bottom-color: rgba(var(--goal-rgb), 0.72);
            color: #fff;
        }

        .goal-actions {
            display: flex;
            gap: 2px;
            opacity: 0;
            transition: opacity 0.2s;
            margin-left: 8px;
            align-self: flex-start;
        }

        .goal-content:hover .goal-actions {
            opacity: 1;
        }

        .goal-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            color: #888;
            font-size: 14px;
        }

        .goal-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .goal-btn.add:hover {
            color: var(--ready-color);
            background: rgba(16, 185, 129, 0.1);
        }

        .goal-btn.move:hover {
            color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .goal-btn.del:hover {
            color: var(--blocked-color);
            background: rgba(239, 68, 68, 0.1);
        }

        .goal-color-picker {
            width: 24px;
            height: 24px;
            border: 1px solid rgba(255, 255, 255, 0.22);
            border-radius: 4px;
            background: transparent;
            padding: 0;
            cursor: pointer;
            overflow: hidden;
        }

        .goal-color-picker:hover {
            border-color: rgba(255, 255, 255, 0.42);
        }

        .goal-color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .goal-color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 2px;
        }

        .goal-children {
            margin-left: 20px;
            padding-left: 14px;
            border-left: 1px solid rgba(var(--goal-rgb), 0.35);
            margin-top: 6px;
        }

        .goal-children.hidden {
            display: none;
        }

        /* --- HABITS PANEL --- */
        #habits-panel {
            width: 420px;
            background: linear-gradient(180deg, #081427 0%, #07111f 50%, #050e1a 100%);
            border-left: 1px solid rgba(74, 141, 235, 0.34);
            display: flex;
            flex-direction: column;
            z-index: 55;
            position: absolute;
            right: 0;
            top: var(--right-rail-reserved-top);
            bottom: 0;
            transition: transform 0.3s ease, visibility 0s linear 0s;
            box-shadow: -14px 0 40px rgba(1, 6, 16, 0.7);
            font-family: 'JetBrains Mono', 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
            color: #9ec7ff;
        }

        #habits-panel.hidden {
            transform: translateX(100%);
            visibility: hidden;
            pointer-events: none;
            transition: transform 0.3s ease, visibility 0s linear 0.3s;
        }

        #habits-panel .panel-header-row {
            border-bottom: 1px solid rgba(74, 141, 235, 0.4);
            background: linear-gradient(90deg, rgba(74, 141, 235, 0.22), rgba(74, 141, 235, 0.05));
            color: #d8ebff;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            font-size: 13px;
        }

        #habits-panel .panel-header-row .btn {
            border: 1px solid rgba(74, 141, 235, 0.56);
            background: rgba(74, 141, 235, 0.16);
            color: #b7d7ff;
            border-radius: 4px;
        }

        #habits-panel .panel-header-row .btn:hover {
            background: rgba(74, 141, 235, 0.34);
            color: #eff8ff;
        }

        .habit-composer {
            padding: 14px;
            border-bottom: 1px solid rgba(74, 141, 235, 0.34);
            background: linear-gradient(180deg, rgba(9, 28, 53, 0.96), rgba(6, 19, 37, 0.88));
            max-height: 1000px;
            opacity: 1;
            overflow: hidden;
            flex-shrink: 0;
            transition: max-height 0.24s ease, opacity 0.2s ease, padding 0.2s ease, border-color 0.2s ease;
        }

        #habits-panel.habit-composer-collapsed .habit-composer {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
            padding-left: 0;
            padding-right: 0;
            border-bottom-color: transparent;
            pointer-events: none;
        }

        .habit-composer-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .habit-composer input,
        .habit-composer select {
            background: #0a1d37;
            border: 1px solid rgba(74, 141, 235, 0.5);
            color: #cfe4ff;
            font-size: 11px;
            border-radius: 4px;
            padding: 6px 8px;
            font-family: inherit;
        }

        .habit-composer input:focus,
        .habit-composer select:focus {
            outline: none;
            border-color: #77afff;
            box-shadow: 0 0 0 1px rgba(119, 175, 255, 0.32);
        }

        .habit-composer .btn {
            border: 1px solid rgba(74, 141, 235, 0.56);
            background: rgba(74, 141, 235, 0.14);
            color: #b7d7ff;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .habit-composer .btn:hover {
            background: rgba(74, 141, 235, 0.34);
            color: #eff8ff;
        }

        .habit-type-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .habit-type-row>* {
            flex: 1;
        }

        #habit-unit-label {
            align-self: center;
            font-size: 10px;
            color: #84afe3;
            display: none;
        }

        .habit-summary-strip {
            padding: 10px 14px 12px;
            border-bottom: 1px solid rgba(74, 141, 235, 0.34);
            background: linear-gradient(180deg, rgba(9, 28, 53, 0.78), rgba(8, 22, 42, 0.5));
            flex-shrink: 0;
        }

        .habit-summary-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #b8d5ff;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 6px;
        }

        .habit-summary-bar {
            height: 8px;
            border: 1px solid rgba(74, 141, 235, 0.66);
            background: rgba(74, 141, 235, 0.12);
            overflow: hidden;
        }

        #habit-summary-progress-fill {
            height: 100%;
            width: 0%;
            background: #4a8deb;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(255, 255, 255, 0.26) 4px, rgba(255, 255, 255, 0.26) 8px);
            transition: width 0.25s ease;
        }

        .habit-summary-stats {
            margin-top: 8px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            color: #93b9eb;
            gap: 8px;
        }

        .habit-filter-row {
            display: flex;
            gap: 8px;
            padding: 10px 14px;
            border-bottom: 1px solid rgba(74, 141, 235, 0.34);
            background: rgba(4, 13, 27, 0.75);
            flex-shrink: 0;
        }

        #habits-list-container {
            min-height: 0;
        }

        .habit-filter-btn {
            flex: 1;
            border: 1px solid rgba(74, 141, 235, 0.52);
            background: rgba(74, 141, 235, 0.1);
            color: #97c2fb;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .habit-filter-btn:hover {
            background: rgba(74, 141, 235, 0.26);
            color: #eef8ff;
        }

        .habit-filter-btn.active {
            background: #4a8deb;
            border-color: #4a8deb;
            color: #071a34;
            box-shadow: 0 0 10px rgba(74, 141, 235, 0.45);
        }

        .habit-item {
            --habit-rgb: 74, 141, 235;
            --habit-accent: #4a8deb;
            background-color: #0b2242;
            border: 1px solid rgba(var(--habit-rgb), 0.8);
            position: relative;
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.42), inset 0 0 0 1px rgba(var(--habit-rgb), 0.14);
            margin-bottom: 14px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
        }

        .habit-item::before,
        .habit-item::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background-color: rgb(var(--habit-rgb));
        }

        .habit-item::before {
            left: -4px;
        }

        .habit-item::after {
            right: -4px;
        }

        .habit-item:hover {
            border-color: rgba(var(--habit-rgb), 0.96);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5), 0 0 16px rgba(var(--habit-rgb), 0.22);
        }

        .habit-item.done-today {
            box-shadow: 0 12px 34px rgba(0, 0, 0, 0.48), 0 0 22px rgba(var(--habit-rgb), 0.3);
        }

        .habit-cad-header {
            padding: 12px 14px;
            border-bottom: 1px dashed rgba(var(--habit-rgb), 0.72);
            background: linear-gradient(90deg, rgba(var(--habit-rgb), 0.16), rgba(var(--habit-rgb), 0.05) 48%, rgba(7, 18, 35, 0.42) 100%);
        }

        .habit-cad-body {
            padding: 12px 14px;
            background-image: linear-gradient(rgba(var(--habit-rgb), 0.15) 1px, transparent 1px), linear-gradient(90deg, rgba(var(--habit-rgb), 0.15) 1px, transparent 1px);
            background-size: 14px 14px;
            background-position: -1px -1px;
        }

        .habit-card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

        .habit-title-wrap {
            min-width: 0;
            flex: 1;
        }

        .habit-title {
            font-weight: 700;
            font-size: 14px;
            color: #06080d;
            letter-spacing: 0.02em;
            line-height: 1.2;
            word-break: break-word;
            display: inline;
            background: rgba(245, 248, 255, 0.98);
            padding: 1px 6px 2px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
            text-transform: uppercase;
        }

        .habit-progress-label {
            font-size: 10px;
            color: #90b9ea;
            margin-top: 4px;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .habit-ratio-pill {
            border: 1px solid rgba(var(--habit-rgb), 0.62);
            background: rgba(var(--habit-rgb), 0.16);
            color: #e4f2ff;
            padding: 3px 8px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.03em;
            white-space: nowrap;
            min-width: 46px;
            text-align: center;
        }

        .habit-ratio-pill.done {
            background: rgba(var(--habit-rgb), 0.9);
            border-color: rgba(var(--habit-rgb), 0.95);
            color: #031227;
        }

        .habit-progress-track {
            height: 10px;
            border: 1px solid rgba(var(--habit-rgb), 0.76);
            background: rgba(var(--habit-rgb), 0.12);
            overflow: hidden;
        }

        .habit-progress-fill {
            height: 100%;
            width: 0%;
            background-color: rgb(var(--habit-rgb));
            background-image: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(255, 255, 255, 0.24) 4px, rgba(255, 255, 255, 0.24) 8px);
            transition: width 0.25s ease;
        }

        .habit-progress-fill.done {
            background-color: rgb(var(--habit-rgb));
        }

        .habit-card-bottom {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
            flex-wrap: wrap;
        }

        .habit-meta {
            font-size: 10px;
            color: #87b9ff;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
            flex-wrap: wrap;
            flex: 1;
        }

        .habit-link-box {
            border: 1px solid rgba(var(--habit-rgb), 0.4);
            background: rgba(9, 24, 45, 0.82);
            padding: 3px 6px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            min-width: 0;
            max-width: 100%;
        }

        .habit-link-label {
            opacity: 0.64;
            letter-spacing: 0.06em;
            flex-shrink: 0;
        }

        .habit-goal-link {
            display: inline-block;
            padding: 2px 7px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.04);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 220px;
            min-width: 0;
        }

        .habit-goal-link.muted {
            color: #6e95c8;
            border-color: rgba(110, 149, 200, 0.35);
            background: rgba(110, 149, 200, 0.08);
        }

        .habit-note-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            border: 1px solid rgba(var(--habit-rgb), 0.52);
            background: rgba(var(--habit-rgb), 0.12);
            color: #b8d8ff;
            padding: 2px 6px;
            border-radius: 999px;
            font-size: 10px;
            cursor: pointer;
        }

        .habit-note-chip:hover {
            background: rgba(var(--habit-rgb), 0.24);
            color: #f2f8ff;
        }

        .habit-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            flex-shrink: 0;
            justify-content: flex-end;
        }

        .habit-color-picker {
            width: 28px;
            height: 28px;
            border: 1px solid rgba(var(--habit-rgb), 0.66);
            background: rgba(var(--habit-rgb), 0.12);
            border-radius: 4px;
            padding: 2px;
            cursor: pointer;
        }

        .habit-color-picker:hover {
            border-color: rgba(var(--habit-rgb), 0.92);
            box-shadow: 0 0 10px rgba(var(--habit-rgb), 0.4);
        }

        .habit-color-picker:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .habit-color-picker:disabled:hover {
            border-color: rgba(var(--habit-rgb), 0.66);
            box-shadow: none;
        }

        .habit-color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .habit-color-picker::-webkit-color-swatch {
            border: none;
        }

        .habit-icon-btn {
            width: 28px;
            height: 28px;
            border: 1px solid rgba(var(--habit-rgb), 0.64);
            background: rgba(var(--habit-rgb), 0.1);
            color: #a9cfff;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            line-height: 1;
            transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
        }

        .habit-icon-btn:hover {
            background: rgba(var(--habit-rgb), 0.9);
            color: #04162d;
            box-shadow: 0 0 10px rgba(var(--habit-rgb), 0.42);
        }

        .habit-icon-btn.active {
            background: rgba(var(--habit-rgb), 0.88);
            color: #04162d;
            border-color: rgba(var(--habit-rgb), 0.96);
        }

        .habit-icon-btn.active-alert {
            border-color: rgba(239, 68, 68, 0.82);
            background: rgba(239, 68, 68, 0.22);
            color: #ffd4d4;
        }

        .habit-icon-btn.active-alert:hover {
            background: rgba(239, 68, 68, 0.82);
            color: #fff;
        }

        .habit-icon-btn.danger {
            border-color: rgba(239, 68, 68, 0.7);
            color: #fca5a5;
        }

        .habit-icon-btn.danger:hover {
            background: rgba(239, 68, 68, 0.86);
            border-color: rgba(239, 68, 68, 0.95);
            color: #fff;
        }

        .habit-controls-row {
            margin-top: 10px;
            border-top: 1px dashed rgba(var(--habit-rgb), 0.44);
            padding-top: 10px;
        }

        .habit-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .habit-main-toggle {
            border: 1px solid rgba(var(--habit-rgb), 0.66);
            background: rgba(var(--habit-rgb), 0.1);
            color: #cbe3ff;
            font-size: 11px;
            font-weight: 700;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .habit-main-toggle:hover {
            background: rgba(var(--habit-rgb), 0.92);
            color: #04162d;
            box-shadow: 0 0 10px rgba(var(--habit-rgb), 0.34);
        }

        .habit-main-toggle.done {
            background: rgba(var(--habit-rgb), 0.92);
            border-color: rgba(var(--habit-rgb), 0.95);
            color: #04162d;
        }

        .habit-btn-small {
            min-width: 40px;
            height: 28px;
            border: 1px solid rgba(var(--habit-rgb), 0.66);
            background: rgba(var(--habit-rgb), 0.1);
            color: #cbe3ff;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            padding: 0 8px;
        }

        .habit-btn-small:hover {
            background: rgba(var(--habit-rgb), 0.92);
            color: #04162d;
            box-shadow: 0 0 10px rgba(var(--habit-rgb), 0.34);
        }

        .habit-play-btn.active {
            background: rgba(239, 68, 68, 0.88);
            border-color: rgba(239, 68, 68, 0.95);
            color: #fff;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.42);
        }

        .habit-val-display {
            border: 1px solid rgba(var(--habit-rgb), 0.45);
            background: rgba(9, 24, 45, 0.82);
            color: #d8ebff;
            min-width: 104px;
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.04em;
            padding: 6px 8px;
        }

        .habit-tech-readout {
            margin-left: auto;
            border: 1px solid rgba(var(--habit-rgb), 0.45);
            background: rgba(9, 24, 45, 0.82);
            color: #8eb8ea;
            font-size: 10px;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            padding: 6px 8px;
        }

        .habit-tech-readout span {
            color: #eff7ff;
        }

        #habits-list-container > div[style*="text-align:center"] {
            border: 1px dashed rgba(74, 141, 235, 0.4);
            background: rgba(9, 28, 53, 0.36);
            color: #8eb8ea !important;
            padding: 14px 10px !important;
            border-radius: 4px;
        }
